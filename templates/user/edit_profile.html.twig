{% extends 'base_user.html.twig' %}
{% block stylesheets %}
    {{ parent() }}
	<link rel="stylesheet" href="{{ asset('assets/dist/css/profil.css')}}">
	<link rel="stylesheet" href="{{ asset('assets/dist/css/select2.css')}}">
{% endblock %}
{% block body %}
    <article class="resume-wrapper text-center position-relative">
		<form method="POST" enctype="multipart/form-data">
			{{form_widget(form._token)}}
			<div class="resume-wrapper-inner mx-auto text-left bg-white shadow-lg">
				<header class="resume-header pt-4 pt-md-0">
				<div class="secondary-info ml-md-auto mt-2">
								<a style="margin-right: 30px;" class="btn-edit-cv btn-div" href="{{ path('user_profile') }}" title="Fermer"><i class="fa fa-times"></i></a>
							</div><!--//secondary-info-->

				</header>
									<div class="row">
				<div class="col-lg-9">
				<div class="resume-body p-5">
							<div class="" style="position: relative;">
								
								<div id="preview" style="min-height: 250px;width: 220px;background-size: cover; opacity: 0.5;background-image:url('{{ asset('./uploads/photos/' ~ user.profileName) }}')">
									<span style="position:absolute;width:1px;overflow: hidden;">
										{{ form_widget(form.profileFile, {attr:{'onchange':'readURL(this)'}}) }} 
										<span class="text-danger">{{ form_errors(form.profileFile) }}</span>
									</span>
								</div>
								<div class="btn-div" id="trig-upl" style="position: absolute;
									position: absolute;
									width: 140px;
									text-align: center;
									padding: 5px;
									border: 1px solid white;
									color: white;
									background-color: #323232;
									top: 20%;
									margin: 0 40px;"
								>
									<i class="fa fa-picture-o"></i> Modifier
								</div>

								<section class="resume-section experience-section mb-5">
									<ul class="list-unstyled">
										<li>
											<label for="firstName">NOM:</label>
											{{ form_widget(form.firstName, {attr:{'class': 'form-control', 'id': 'firstName'}}) }}
											<span class="text-danger">{{ form_errors(form.firstName) }}</span>
										</li>
										<li>
											<label for="lastName">PRENOM(S):</label>
											{{ form_widget(form.lastName, {attr:{'class': 'form-control', 'id': 'lastName'}}) }}
											<span class="text-danger">{{ form_errors(form.lastName) }}</span>
										</li>
										<li class="mb-2">
											<label for="email">EMAIL:</label>
											{{ form_widget(form.email, {attr:{'class': 'form-control', 'id': 'email'}}) }}
											<span class="text-danger">{{ form_errors(form.email) }}</span>
										</a></li>
										<li>
											<label for="email"> TELEPHONE:</label>
											{{ form_widget(form.phoneNumber, {attr:{'class': 'form-control', 'id': 'phone'}}) }}
											<span class="text-danger">{{ form_errors(form.phoneNumber) }}</span>
										</li>
									</ul>
								</section><!--//primary-info-->
							</div><!--//media-->

							{# <section class="resume-section summary-section mb-5">
								<h2 class="resume-section-title text-uppercase font-weight-bold pb-3 mb-3">OBJECTIF</h2>
								<div class="resume-section-content">
									<p class="mb-0">Summarise your career here. Lorem ipsum dolor sit amet, consectetuer adipiscing elit.</p>
								</div>
							</section> #}

							<section class="resume-section experience-section mb-5">
								<h2 class="resume-section-title text-uppercase font-weight-bold pb-3 mb-3">Etat civil</h2>
								<p>
									<label for="dateOfBirth">DATE DE NAISSANCE:</label>
									{{ form_widget(form.dateOfBirth, {attr:{'class': 'form-control', 'type': 'date', 'required': false, 'max': "now"|date('Y-m-d')}}) }}
									<span class="text-danger">{{ form_errors(form.dateOfBirth) }}</span>
								</p>
								<p>
									<label for="placeOfBirth">LIEU DE NAISSANCE:</label>
									{{ form_widget(form.placeOfBirth, {attr:{'class': 'form-control', 'id': 'placeOfBirth'}}) }}
									<span class="text-danger">{{ form_errors(form.placeOfBirth) }}</span>
								</p>
								<p>
									<label for="maritalStatus">SITUATION MATRIMONIALE:</label>
									{{ form_widget(form.maritalStatus, {attr:{'class': 'form-control', 'id': 'maritalStatus'}}) }}
									<span class="text-danger">{{ form_errors(form.maritalStatus) }}</span>
								</p>
								<p>
									<label for="conjointName">NOM CONJOINT(E):</label>
									{{ form_widget(form.conjointName, {attr:{'class': 'form-control', 'id': 'conjointName'}}) }}
									<span class="text-danger">{{ form_errors(form.conjointName) }}</span>
								</p>
								<p>
									<label for="nbChildren">NOMBRE D'ENFANTS:</label>
									{{ form_widget(form.nbChildren, {attr:{'class': 'form-control', 'id': 'nbChildren'}}) }}
									<span class="text-danger">{{ form_errors(form.nbChildren) }}</span>
								</p>
								<p>
									<label for="nbChildren">NATIONALITE</label>
									{{ form_widget(form.nationality, {attr:{'class': 'form-control', 'id': 'nationality'}}) }}
									<span class="text-danger">{{ form_errors(form.nationality) }}</span>
								</p>
								<p>	
									<label for="addressaddress">ADRESSE:</label>
									{{ form_widget(form.address, {attr:{'class': 'form-control', 'id': 'address', 'rows': 5}}) }}
									<span class="text-danger">{{ form_errors(form.address) }}</span>
								</p>
								<br/>

								<h2 class="resume-section-title text-uppercase font-weight-bold pb-3 mb-3">HOBBIES</h2>
								<div id="user-hobbies">
									{{ form_widget(form.hobbies, {attr:{'id': 'hobbies'}}) }}
									<span class="text-danger">{{ form_errors(form.hobbies) }}</span>
								</div>
								<br/>

								<h2 class="resume-section-title text-uppercase font-weight-bold pb-3 mb-3">ACTIVITES EXTRA PROFESSIONNELLES</h2>
								<div id="extra-work-activity" class="container" style="min-height: 50px;">
								{% form_theme form 'collection/jquery.collection.html.twig' %}
								{{ form_row(form.extraWorkActivities) }}
								</div>

								<br/>

								<h2 class="resume-section-title text-uppercase font-weight-bold pb-3 mb-3">SPORTS</h2>
								<div id="user-sports">
									{{ form_widget(form.sports, {attr:{'id': 'sports'}}) }}
									<span class="text-danger">{{ form_errors(form.sports) }}</span>
								</div>
								<br/>

								<h2 class="resume-section-title text-uppercase font-weight-bold pb-3 mb-3" id="training">LANGUES</h2>
								<div id="extra-work-activity"  class="container" style="min-height: 50px;">
								{% form_theme form 'collection/jquery.collection.html.twig' %}
									{{ form_row(form.languages) }}	
								</div>
								<br/>
								<h2 class="resume-section-title text-uppercase font-weight-bold pb-3 mb-3" id="training">FORMATIONS</h2>
								<div id="extra-work-activity"  class="container" style="min-height: 50px;">
								{% form_theme form 'collection/jquery.collection.html.twig' %}
									{{ form_row(form.trainings) }}	
								</div>

								<br/>

								<h2 class="resume-section-title text-uppercase font-weight-bold pb-3 mb-3" id="experience">MES PARCOURS PROFESSIONELS</h2>
								<div id="extra-work-activity"  class="container" style="min-height: 50px;">
								{% form_theme form 'collection/jquery.collection.html.twig' %}
									{{ form_row(form.experiences) }}
								</div>

								<br/>

								<h2 class="resume-section-title text-uppercase font-weight-bold pb-3 mb-3" id="c4" style="margin-top: 50px">MES COMPETENCES</h2>
								<div id="extra-work-activity"  class="container" style="min-height: 50px;">
								{% form_theme form 'collection/jquery.collection.html.twig' %}
									{{ form_row(form.skills) }}
								</div>
								<br/>

								<div style="padding:20px; margin-top:30px;text-align:center;">
									<input style="font-size:15px;" type="submit" class="btn btn-primary" value="Sauvegarder"> ou 
									<a href="{{ path('user_profile') }}"class="btn btn-default" style="font-size:15px;"><i class="fa fa-times"></i> Revenir</a>
									{% if app.user.submit %}
									<a class="btn btn-success" href="#" title="Soumettre mon cv pour validation">CV Soumis</a>
									{% else %}
									<a class="btn btn-primary changeme disabled" href="{{ path('user_cv_send', {'id' : user.id}) }}" title="Soumettre mon cv pour validation">Soumettre mon CV pour validation</a>
									{% endif %}
									<div>
										<input type="checkbox" id="valide" name="valide">
										<label for="valide">Je déclare que les renseignements ci-dessus sont sincères et exactes.</label>
									</div>
								</div>
							</section>
						</div>
					</div>
				</div>
			</div>
		</form>
	</article>

{% endblock body %}
{% block javascripts %}
	<script type="text/javascript">
     	function readURL(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    $('#preview')
                        .css('backgroundImage', 'url(' + e.target.result +')');
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

		var hobbies = new Bloodhound({
			prefetch: window.location.origin + '/hobbies',
			datumTokenizer: Bloodhound.tokenizers.obj.whitespace('name'),
			queryTokenizer: Bloodhound.tokenizers.whitespace,
		});

		var sports = new Bloodhound({
			prefetch: window.location.origin + '/sports',
			datumTokenizer: Bloodhound.tokenizers.obj.whitespace('name'),
			queryTokenizer: Bloodhound.tokenizers.whitespace,
		});

		jQuery(document).ready(function($) {
			$(document).find('select').each(function(event){
				$(this).selectize({
					allowEmptyOption: true,
					create: true
				});
			});

			$("#user_phoneNumber").intlTelInput({
				// whether or not to allow the dropdown
				allowDropdown: true,
				// if there is just a dial code in the input: remove it on blur, and re-add it on focus
				autoHideDialCode: false,
				// add a placeholder in the input with an example number for the selected country
				autoPlaceholder: "polite",
				// modify the auto placeholder
				customPlaceholder: null,
				// append menu to specified element
				dropdownContainer: null,
				// don't display these countries
				excludeCountries: [],
				// format the input value during initialisation and on setNumber
				formatOnDisplay: true,
				// geoIp lookup function
				geoIpLookup: null,
				// inject a hidden input with this name, and on submit, populate it with the result of getNu
				hiddenInput: "",
				// initial country
				initialCountry: "mg",
				// localized country names e.g. { 'de': 'Deutschland' }
				localizedCountries: {'fr': 'France'},
				// don't insert international dial codes
				nationalMode: false,
				// number type to use for placeholders
				placeholderNumberType: "MOBILE",
				// the countries at the top of the list. defaults to united states and united kingdom
				preferredCountries: [ "mg", "fr" ],
				// display the country dial code next to the selected flag so it's not part of the typed number
				separateDialCode: false,
				// specify the path to the libphonenumber script to enable validation/formatting
				utilsScript: ""
			});
			// $('#user_maritalStatus').select2();
			// $('#user_nationality').select2();
			// $('.language_level').select2();
			$('#user_experiences').addClass('container');
			$('#trig-upl').on('click', function(){
				$('#user_profileFile').trigger('click');
			})
			$('.collection-selector-user-extraWorkActivities').collection({
				allow_up: false,
				allow_down: false,
				add: '<a href="#"><i title="Ajouter" class="fa fa-plus collection-btn"></i></a>',
				remove: '<a href="#"><i title="Supprimer" class="fa fa-times collection-btn"></i></a>',
			});
			$('.collection-selector-user-trainings').collection({
				allow_up: false,
				allow_down: false,
				add: '<a href="#"><i title="Ajouter" class="fa fa-plus collection-btn"></i></a>',
				remove: '<a href="#"><i title="Supprimer" class="fa fa-times collection-btn"></i></a>',
			});
			$('.collection-selector-user-skills').collection({
				allow_up: false,
				allow_down: false,
				add: '<a href="#"><i title="Ajouter" class="fa fa-plus collection-btn"></i></a>',
				remove: '<a href="#"><i title="Supprimer" class="fa fa-times collection-btn"></i></a>',
			});
			$('.collection-selector-user-languages').collection({
				allow_up: false,
				allow_down: false,
				add: '<a href="#"><i title="Ajouter" class="fa fa-plus collection-btn"></i></a>',
				remove: '<a href="#"><i title="Supprimer" class="fa fa-times collection-btn"></i></a>',
			});
			$('.collection-selector-user-experience').collection({
				allow_up: false,
				allow_down: false,
				add: '<a href="#"><i title="Ajouter" class="fa fa-plus collection-btn"></i></a>',
				remove: '<a href="#"><i title="Supprimer" class="fa fa-times collection-btn"></i></a>',
				prefix: 'parent',
				add_at_the_end: true,
				children: [{
					selector: '.collection-selector-people-reference',
					prefix: 'child',
					allow_up: false,
					allow_down: false,
					add_at_the_end: true,
					add: '<a href="#"><i title="Ajouter" class="fa fa-plus collection-btn"></i><span style="font-size:10px;">Ajouter une personne de référence</span></a>',
					remove: '<a href="#"><i title="Supprimer" class="fa fa-times collection-btn"></i></a>',
					// ...
				}]
			});

			$('#user_dateOfBirth').change(function() {
				var today = new Date();
				var selectedDate = $('#user_dateOfBirth').val();
				var selectedInput = $('#user_dateOfBirth');
				var dd = today.getDate();
				var mm = today.getMonth()+1; 
				var yyyy = today.getFullYear();
				if(dd < 10) 
				{
				    dd='0'+dd;
				}

				if(mm < 10) 
				{
				    mm='0'+mm;
				}

				today = yyyy+'-'+mm+'-'+dd;

				if (selectedDate > today) {
					selectedInput.val(today);
				}
			});

			$('*[id*=startDate]').each(function(index) {
				$(this).change(function() {
					var startDate = $(this).val();
					$('#user_trainings_'+ index +'_endDate').attr({'min': startDate});
					$('#user_trainings_'+ index +'_endDate').change(function() {
						if ($(this).val() < startDate) {
							$('#user_trainings_'+ index +'_endDate').val(startDate);
						}
					});
				})
			});

			$('*[id*=date_debut]').each(function(index) {
				$(this).change(function() {
					var startDate = $(this).val();
					$('#user_experiences_'+ index +'_date_fin').attr({'min': startDate});
					$('#user_experiences_'+ index +'_date_fin').change(function() {
						if ($(this).val() < startDate) {
							$('#user_experiences_'+ index +'_date_fin').val(startDate);
						}
					});
				})
			});
		});

		$('.tag-input').tagsinput({
			typeaheadjs: [{
				highlights: true,
			},{
				name: 'hobbies',
				display: 'name',
				value: 'name',
				source: this.hobbies
			}]
		});

		$('.sports-tag-input').tagsinput({
			typeaheadjs: [{
				highlights: true,
			},{
				name: 'sports',
				display: 'name',
				value: 'name',
				source: this.sports
			}]
		});

		$('.collection-selector-user-interviews').collection({
			allow_up: false,
			allow_down: false,
			add: '<a href="#"><i title="Ajouter" class="fa fa-plus collection-btn"></i></a>',
			remove: '<a href="#"><i title="Supprimer" class="fa fa-times collection-btn"></i></a>',
		});

		$('#valide').change(function(){
			if($(this).is(":checked")) {				
				$('.changeme').removeClass('disabled');
			} else {
				$('.changeme').addClass('disabled');
			}
		});
		</script>
{% endblock %}